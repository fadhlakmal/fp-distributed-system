(venv) reynaldineo@DESKTOP-3QCS6CA:~/sister/fp/test/skenario2(mainâš¡) Â» python3 fail.py

================================================================================
ğŸš€ MySQL GROUP REPLICATION - PRIMARY FAILOVER TEST
================================================================================

ğŸ“‹ Step 1: Check initial Group Replication status

================================================================================
ğŸ“Š Initial Group Status
================================================================================
Node       Host            Port   State        Role
--------------------------------------------------------------------------------
node1      node3           3306   ONLINE       SECONDARY
node1      node2           3306   ONLINE       SECONDARY
node1      node1           3306   ONLINE       PRIMARY
================================================================================


ğŸ“‹ Step 2: Identify current primary node
âœ… Current PRIMARY: node1 (Port: 3306)

ğŸ“‹ Step 3: Setup test database

ğŸ”§ Setting up test database...
âœ… Database and table created successfully

ğŸ“‹ Step 4: Start continuous workload

ğŸ”„ Starting continuous workload...

â³ Letting workload run for 10 seconds...
ğŸ“ Inserted 10 transactions (Attempts: 10, Failed: 0)
ğŸ“ Inserted 20 transactions (Attempts: 20, Failed: 0)

ğŸ“‹ Step 5: Simulate PRIMARY node failure

âš ï¸  Stopping PRIMARY node: node1

ğŸ›‘ Stopping container: node1
âœ… Container node1 stopped

ğŸ“‹ Step 6: Observe failover process
â³ Waiting for new primary election...
ğŸ“ Inserted 30 transactions (Attempts: 30, Failed: 0)

âœ… NEW PRIMARY ELECTED: node3 (Port: 3308)

================================================================================
ğŸ“Š Status After Failover
================================================================================
Node       Host            Port   State        Role
--------------------------------------------------------------------------------
node1      node2           3306   ONLINE       SECONDARY
node1      node3           3306   ONLINE       PRIMARY
================================================================================


â³ Continuing workload on new primary for 10 seconds...
ğŸ“ Inserted 40 transactions (Attempts: 40, Failed: 0)
ğŸ“ Inserted 50 transactions (Attempts: 50, Failed: 0)

ğŸ“‹ Step 7: Restart old primary node

ğŸ—‘ï¸  Removing stopped container: node1
âœ… Container node1 removed

â–¶ï¸  Recreating container: node1 using docker-compose
âœ… Container node1 recreated and started
â³ Waiting for MySQL to be ready...

âš ï¸  FAILOVER DETECTED at 23:01:00.462

âœ… FAILOVER COMPLETED at 23:01:01.886
â±ï¸  Failover Duration: 1.42 seconds
ğŸ“ Inserted 68 transactions (Attempts: 70, Failed: 2)
ğŸ”„ Rejoining node1 to cluster...
âš ï¸  Exception during rejoin: '_GeneratorContextManager' object has no attribute 'cursor'

â³ Waiting for node to rejoin cluster...
ğŸ“ Inserted 78 transactions (Attempts: 80, Failed: 2)
ğŸ“ Inserted 88 transactions (Attempts: 90, Failed: 2)
ğŸ“ Inserted 98 transactions (Attempts: 100, Failed: 2)

================================================================================
ğŸ“Š Final Group Status
================================================================================
Node       Host            Port   State        Role
--------------------------------------------------------------------------------
node1      node1           3306   ONLINE       SECONDARY
node1      node2           3306   ONLINE       SECONDARY
node1      node3           3306   ONLINE       PRIMARY
================================================================================


ğŸ“‹ Step 8: Stopping workload

================================================================================
ğŸ“ˆ FINAL STATISTICS
================================================================================
Total Insert Attempts: 104
Successful Inserts: 102
Failed Inserts: 2
Success Rate: 98.08%

â±ï¸  Failover Metrics:
Failover Duration: 1.42 seconds
Transactions Lost During Failover: 2

âŒ Errors Breakdown:
  - no_primary: 2
================================================================================


ğŸ“‹ Step 9: Verify data consistency

ğŸ” Verifying data consistency across nodes...

ğŸ“Š Transaction counts per node:
  node1: 102
  node2: 102
  node3: 102

âœ… Data is consistent across all nodes!

================================================================================
âœ… TEST COMPLETED
================================================================================